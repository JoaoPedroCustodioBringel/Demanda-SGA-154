<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2">Gerenciador de Tarefas</h1>
    <button class="btn btn-primary" (click)="onNewTask()">
      Nova Tarefa
    </button>
  </div>

  @if (taskService.error()) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    {{ taskService.error() }}
    <button type="button" class="btn-close" (click)="taskService.error.set(null)"></button>
  </div>
  }

  @if (taskService.loading()) {
  <div class="text-center my-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>
  }

  @if (!taskService.loading()) {
  @if (taskService.tasks().length === 0) {
  <div class="alert alert-info" role="alert">
    Nenhuma tarefa cadastrada. Clique em "Nova Tarefa" para começar.
  </div>
  } @else {
  <div class="row g-3">
    @for (task of taskService.tasks(); track task.id) {
    <div class="col-md-6 col-lg-4">
      <div class="card h-100" [class.bg-light]="task.completed">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title" [class.text-decoration-line-through]="task.completed">
              {{ task.title }}
            </h5>
            <span class="badge" [ngClass]="getPriorityBadgeClass(task.priority)">
              {{ getPriorityLabel(task.priority) }}
            </span>
          </div>

          <p class="card-text text-muted" [class.text-decoration-line-through]="task.completed">
            {{ task.description }}
          </p>

          <p class="text-muted small mb-3">
            Vencimento: {{ formatDate(task.dueDate) }}
          </p>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" [checked]="task.completed"
              (click)="onToggleComplete($event, task)" [disabled]="isProcessing(task.id)" [id]="'completed-' + task.id">
            <label class="form-check-label" [for]="'completed-' + task.id">
              @if (isProcessing(task.id)) {
              <span class="spinner-border spinner-border-sm me-1"></span>
              }
              {{ task.completed ? 'Concluída' : 'Pendente' }}
            </label>
          </div>

          <div class="d-grid gap-2">
            <button class="btn btn-sm btn-outline-primary" (click)="onEditTask(task)">
              Editar
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="onDeleteTask(task)">
              Excluir
            </button>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
  }
  }
</div>